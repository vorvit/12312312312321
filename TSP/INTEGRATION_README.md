# Интеграция TSP IFC Viewer с Auth Service

## Обзор

Этот проект интегрирует IFC Viewer на базе [ThatOpen Engine](https://github.com/ThatOpen/) с системой аутентификации, обеспечивая:

- ✅ Аутентификацию пользователей в вьюере
- ✅ Загрузку IFC файлов из защищённого хранилища
- ✅ Минимальное вмешательство в существующий код
- ✅ Перенаправление на загрузку файлов в Auth проекте

## Архитектура интеграции

```
Auth Service (localhost:8000) ←→ TSP Viewer (localhost:5173)
     ↓                              ↓
  Хранилище файлов              Отображение IFC
  Аутентификация                Загрузка файлов
  Управление пользователями     Просмотр моделей
```

## Компоненты интеграции

### 1. AuthIntegration (`src/auth-integration.ts`)
- Проверка аутентификации
- Загрузка файлов пользователя
- Управление токенами
- Перенаправления

### 2. UserPanel (`src/ui-templates/auth/user-panel.ts`)
- Отображение информации о пользователе
- Меню пользователя (Dashboard, Upload, Logout)
- Кнопка входа для неаутентифицированных

### 3. FileBrowser (`src/ui-templates/auth/file-browser.ts`)
- Список IFC файлов пользователя
- Поиск файлов
- Выбор файла для просмотра
- Кнопка загрузки новых файлов

## Установка и запуск

### 1. Запуск Auth Service
```bash
cd ../Auth
python start.py
```

### 2. Запуск TSP Viewer
```bash
cd TSP
npm install
npm run dev
```

### 3. Доступ к системе
- Auth Service: http://localhost:8000
- TSP Viewer: http://localhost:5173

## Использование

### 1. Аутентификация
- Пользователь заходит в Auth Service
- Регистрируется/входит в систему
- Загружает IFC файлы

### 2. Просмотр файлов
- В Auth Service нажимает "View" на IFC файле
- Автоматически перенаправляется в TSP Viewer
- Файл загружается и отображается в 3D

### 3. Управление файлами
- В TSP Viewer можно загружать новые файлы
- Переходить в Dashboard для управления
- Выходить из системы

## API Endpoints

### Auth Service
- `GET /users/me` - информация о пользователе
- `GET /api/files` - список файлов пользователя
- `GET /files/download/{filename}` - скачивание файла
- `GET /ifc-viewer` - перенаправление в TSP Viewer

### TSP Viewer
- Автоматическая загрузка файлов при выборе
- Интеграция с существующими инструментами вьюера
- Сохранение всех функций ThatOpen Engine

## Безопасность

- ✅ JWT токены для аутентификации
- ✅ Проверка прав доступа к файлам
- ✅ Безопасная передача токенов через URL
- ✅ Автоматическая очистка токенов при выходе

## Разработка

### Добавление новых функций
1. Расширьте `AuthIntegration` для новых API
2. Создайте UI компоненты в `src/ui-templates/auth/`
3. Интегрируйте в `main.ts` с минимальными изменениями

### Отладка
- Проверьте консоль браузера для ошибок
- Убедитесь, что Auth Service запущен
- Проверьте токены в localStorage

## Структура файлов

```
TSP/
├── src/
│   ├── auth-integration.ts          # Основной модуль интеграции
│   ├── ui-templates/auth/
│   │   ├── user-panel.ts           # Панель пользователя
│   │   └── file-browser.ts         # Браузер файлов
│   └── main.ts                     # Интеграция в основной код
├── package.json
└── INTEGRATION_README.md           # Эта инструкция
```

## Troubleshooting

### Проблема: Файлы не загружаются
- Проверьте, что Auth Service запущен
- Убедитесь в правильности токена
- Проверьте CORS настройки

### Проблема: Не работает аутентификация
- Очистите localStorage
- Перезайдите в Auth Service
- Проверьте URL токена

### Проблема: Ошибки в консоли
- Проверьте версии зависимостей
- Убедитесь в правильности импортов
- Проверьте TypeScript компиляцию
